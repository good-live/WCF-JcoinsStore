/*
 * @author	Joshua Ruesweg
 * @copyright	2015-2016 wcflabs.de
 * @license	WCFLabs.de-Lizenz <https://wcflabs.de/license/license.txt>
 * @package	de.wcflabs.goodlive.steamGame.jcoins
 */
(function(){!function(t,i){"use strict";var e,a,n,o,r,s,l;return a={log:function(t){},warn:function(t){},error:function(t){}},e=Class.extend({_dialog:null,_didInit:!1,_proxy:null,_notification:null,init:function(){return WCF.System.Event.addListener("de.wcflabs.wcf.jcoins.Panel","initedDropdown",t.proxy(this._initButton,this))},_initButton:function(){var i;return i=WCF.Language.get("wcf.jcoins.steamTransfer.title"),t('<li id="steamTransferButton"><span title="'+i+'" class="jsTooltip"><span class="icon fa fa-cloud-upload pointer"></span></span></li>').appendTo(".interactiveDropdown[data-source=jcoinsPanel] ul.interactiveDropdownLinks"),t("#steamTransferButton").click(this._click.bind(this))},_click:function(){return this._didInit?this._dialog.wcfDialog("open"):(this._dialog=t("<div />").hide().appendTo(document.body),this._proxy=new WCF.Action.Proxy({autoSend:!0,data:{actionName:"getTransferToSteamOverlay",className:"wcf\\data\\jcoins\\statement\\SteamJCoinsStatementAction"},success:t.proxy(this._success,this),failure:t.proxy(this._failure,this)}),this._didInit=!0)},_submit:function(){var t;return this._dialog.find(".formSubmit > button[data-type=submit]").disable(),t=this._dialog.find("#amountInput").val(),1>t?void this._throwDialogError("amount",WCF.Language.get("wcf.global.form.error.empty")):(this._proxy.setOption("data",{actionName:"transferToSteam",className:"wcf\\data\\jcoins\\statement\\SteamJCoinsStatementAction",parameters:{amount:t}}),this._proxy.sendRequest())},_throwDialogError:function(i,e){var a;return t(".innerError").remove(),t(".formError").removeClass("formError"),a=i.charAt(0).toUpperCase()+i.slice(1),this._dialog.find("#transferToSteamOverlay"+a+"Dl").addClass("formError"),this._dialog.find("#transferToSteamOverlay"+a+"Dl > dd > .innerError").length&&this._dialog.find("#transferToSteamOverlay"+a+"Dl > dd > .innerError").remove(),this._dialog.find("#"+i+"Input").after(t('<small class="innerError">'+e+"</small>")),this._dialog.find(".formSubmit > button[data-type=submit]").enable()},_success:function(t){return"getTransferToSteamOverlay"===t.actionName?(this._dialog.html(t.returnValues.template),this._dialog.find(".formSubmit > button[data-type=submit]").click(this._submit.bind(this)),this._dialog.wcfDialog({title:WCF.Language.get("wcf.jcoins.steamTransfer.title")})):(null==this._notification&&(this._notification=new WCF.System.Notification(WCF.Language.get("wcf.jcoins.steamTransfer.success"))),this._dialog.wcfDialog("close"),this._notification.show(),this._dialog.find(".formSubmit > button[data-type=submit]").enable(),this._dialog.find("#amountInput").val(""),this._dialog.find(".formError").removeClass("formError"),this._dialog.find(".innerError").remove())},_failure:function(t){var i,e,n;return a.log("request failed"),this._dialog.find(".formSubmit > button[data-type=submit]").enable(),null==(null!=t&&null!=(i=t.returnValues)?i.errorType:void 0)&&null==(null!=t?t.message:void 0)?!0:(this._dialog.find(".formSubmit > button[data-type=submit]").enable(),this._throwDialogError(null!=t&&null!=(e=t.returnValues)?e.fieldName:void 0,null!=t&&null!=(n=t.returnValues)?n.errorType:void 0),!1)}}),null==i.de&&(i.de={}),null==(n=i.de).wcflabs&&(n.wcflabs={}),null==(o=i.de.wcflabs).goodlive&&(o.goodlive={}),null==(r=i.de.wcflabs.goodlive).steamGame&&(r.steamGame={}),null==(s=i.de.wcflabs.goodlive.steamGame).jcoins&&(s.jcoins={}),null!=(l=i.de.wcflabs.goodlive.steamGame.jcoins).TransferToSteamOverlay?l.TransferToSteamOverlay:l.TransferToSteamOverlay=e}(jQuery,this)}).call(this);